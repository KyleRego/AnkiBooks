@using System.Text.Json
@using AnkiBooks.ApplicationCore.Entities
@inject IAnkiBooksApiService ApiService
@inject NavigationManager Navigation
@inject IConfiguration Config
@inject ILogger<New> Logger
@layout ArticlesLayout

<div>
    <EditForm   Model="Article"
                OnValidSubmit="SubmitForm"
                OnInvalidSubmit="LogInvalidSubmit"
                FormName="NewArticle">

        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-3">
            <label for="article-title">Title:</label>
            <InputText @bind-Value="Article.Title" id="article-title" class="w-100" />
        </div>

        <button type="submit">Create</button>

    </EditForm>
</div>

@code {
    [SupplyParameterFromForm]
    private Article Article { get; set; } = new("");

    private async Task SubmitForm()
    {
        ArgumentNullException.ThrowIfNull(Article);
        ArgumentNullException.ThrowIfNullOrWhiteSpace(Article.Title);

        Article? article = await ApiService.PostArticle(Article);
        ArgumentNullException.ThrowIfNull(article);

        Navigation.NavigateTo($"articles/{article.Id}");
    }

    private void LogInvalidSubmit()
    {
        Logger.LogInformation("it was invalid");
    }
}