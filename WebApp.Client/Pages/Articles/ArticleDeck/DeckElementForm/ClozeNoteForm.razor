@using AnkiBooks.ApplicationCore.Entities

<div class="w-72 px-2 pt-2 pb-1 border-primary-thin">
    <EditForm Model="ClozeNote" OnValidSubmit="SubmitForm">
        <DataAnnotationsValidator />
        <ValidationSummary />
        <div class="d-flex flex-column">
            <div class="mb-1 d-flex justify-content-end">
                <button type="button" @onclick="Cancel">
                    Cancel
                </button>
            </div>

            <InputTextArea @bind-Value="ClozeNote.Text" id="Text" class="p-2 mb-1" />

            <div class="d-flex justify-content-center">
                <button type="submit">
                    @SubmitButtonText()
                </button>
            </div>
        </div>
    </EditForm>
</div>

@code {
    [Parameter]
    public ClozeNote StartingClozeNote { get; set; } = null!;

    protected override void OnInitialized()
    {
        ClozeNote = StartingClozeNote;
    }

    [Parameter]
    public bool EditingExisting { get; set; }

    private string SubmitButtonText()
    {
        return EditingExisting ? "Update cloze note" : "Create cloze note";
    }

    [Parameter]
    public Func<ClozeNote, Task> ParentSubmitMethod { get; set; } = null!;

    private async Task SubmitForm()
    {
        await ParentSubmitMethod.Invoke(ClozeNote);
    }

    [SupplyParameterFromForm]
    public ClozeNote ClozeNote { get; set; } = null!;

    [Parameter]
    public bool EditingCard { get; set; }

    [Parameter]
    public EventCallback<bool> EditingCardChanged { get; set; }

    private async Task Cancel()
    {
        EditingCard = false;
        await EditingCardChanged.InvokeAsync(EditingCard);
    }
}