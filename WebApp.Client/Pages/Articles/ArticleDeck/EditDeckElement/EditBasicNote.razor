@using System.ComponentModel.DataAnnotations
@using System.Text.Json

@using AnkiBooks.ApplicationCore.Entities
@using AnkiBooks.ApplicationCore.Interfaces
@using AnkiBooks.ApplicationCore.Services

@inject ILogger<EditBasicNote> Logger
@inject ICardService CardService

<BasicNoteForm  StartingBasicNote="@StartingBasicNote"
                EditingExisting="true"
                ParentSubmitMethod="@SubmitForm"
                @bind-EditingCard:get="@EditingCard"
                @bind-EditingCard:set="@EditingCardChanged" />

@code {
    [Parameter]
    public BasicNote? StartingBasicNote { get; set; }

    [Parameter]
    public bool EditingCard { get; set; }

    [Parameter]
    public EventCallback<bool> EditingCardChanged { get; set; }

    private async Task SubmitForm(BasicNote editBasicNote)
    {
        ArgumentNullException.ThrowIfNull(editBasicNote.Front);
        ArgumentNullException.ThrowIfNull(editBasicNote.Back);
        ArgumentNullException.ThrowIfNull(editBasicNote.DeckId);

        BasicNote? updatedBasicNote = (BasicNote?)await CardService.PutCard(editBasicNote);
        ArgumentNullException.ThrowIfNull(updatedBasicNote);

        EditingCard = false;
        await EditingCardChanged.InvokeAsync(EditingCard);
    }
}