@using System.ComponentModel.DataAnnotations
@using System.Text.Json
@using AnkiBooks.ApplicationCore.Entities
@using AnkiBooks.ApplicationCore.Interfaces
@inject ILogger<EditClozeNote> Logger
@inject IAnkiBooksApiService ApiService

<ClozeNoteForm  StartingClozeNote="@StartingClozeNote"
                EditingExisting="true"
                ParentSubmitMethod="@SubmitForm" />

@code {
    [Parameter]
    public ClozeNote? StartingClozeNote { get; set; }

    [Parameter]
    public bool Editing { get; set; }

    [Parameter]
    public EventCallback<bool> EditingChanged { get; set; }

    private async Task SubmitForm(ClozeNote updatedClozeNote)
    {
        ArgumentNullException.ThrowIfNull(updatedClozeNote.Text);
        ArgumentNullException.ThrowIfNull(updatedClozeNote.SectionId);
        ArgumentNullException.ThrowIfNull(updatedClozeNote.OrdinalPosition);

        ClozeNote? clozeNote = (ClozeNote?)await ApiService.PutNote(updatedClozeNote);
        ArgumentNullException.ThrowIfNull(clozeNote);

        Editing = false;
        await EditingChanged.InvokeAsync(Editing);
    }
}