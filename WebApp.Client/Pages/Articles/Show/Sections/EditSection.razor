@inherits ChangesOrderedElementsContainerBase
@using System.ComponentModel.DataAnnotations
@using System.Text.Json
@using AnkiBooks.ApplicationCore.Entities
@using AnkiBooks.ApplicationCore.Enums
@using AnkiBooks.ApplicationCore.Interfaces
@inject IAnkiBooksApiService ApiService

<SectionForm  StartingSection="@StartingSection"
                EditingExisting="true"
                ParentSubmitMethod="@SubmitForm" />

@code {
    [Parameter]
    public Section StartingSection { get; set; } = null!;

    [Parameter]
    public bool Editing { get; set; }

    [Parameter]
    public EventCallback<bool> EditingChanged { get; set; }

    private async Task SubmitForm(Section newSection)
    {
        ArgumentNullException.ThrowIfNull(newSection.Text);
        Section? createdSection = await ApiService.PutSection(newSection);
        ArgumentNullException.ThrowIfNull(newSection);

        Editing = false;
        await EditingChanged.InvokeAsync(Editing);
    }
}