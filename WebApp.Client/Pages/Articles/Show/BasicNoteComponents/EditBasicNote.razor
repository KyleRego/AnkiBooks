@using System.ComponentModel.DataAnnotations
@using System.Text.Json
@using AnkiBooks.ApplicationCore.Entities
@using AnkiBooks.ApplicationCore.Interfaces
@inject ILogger<EditBasicNote> Logger
@inject IAnkiBooksApiService ApiService

<BasicNoteForm  StartingBasicNote="@StartingBasicNote"
                EditingExisting="true"
                ParentSubmitMethod="@SubmitForm" />

@code {
    [Parameter]
    public BasicNote? StartingBasicNote { get; set; }

    [Parameter]
    public bool Editing { get; set; }

    [Parameter]
    public EventCallback<bool> EditingChanged { get; set; }

    private async Task SubmitForm(BasicNote updatedBasicNote)
    {
        ArgumentNullException.ThrowIfNull(updatedBasicNote.Front);
        ArgumentNullException.ThrowIfNull(updatedBasicNote.Back);
        ArgumentNullException.ThrowIfNull(updatedBasicNote.ArticleId);
        ArgumentNullException.ThrowIfNull(updatedBasicNote.OrdinalPosition);

        BasicNote? basicNote = await ApiService.PutBasicNote(updatedBasicNote);
        ArgumentNullException.ThrowIfNull(basicNote);

        Editing = false;
        await EditingChanged.InvokeAsync(Editing);
    }
}