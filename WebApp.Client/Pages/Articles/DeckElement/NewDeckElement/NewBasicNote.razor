@using System.ComponentModel.DataAnnotations
@using System.Text.Json

@using AnkiBooks.ApplicationCore.Entities
@using AnkiBooks.ApplicationCore.Enums
@using AnkiBooks.ApplicationCore.Interfaces
@using AnkiBooks.ApplicationCore.Services

@inject ILogger<NewBasicNote> Logger
@inject ICardService CardService

<BasicNoteForm  StartingBasicNote="@StartingBasicNote()"
                EditingExisting="false"
                ParentSubmitMethod="@SubmitForm" />

@code {
    [Parameter]
    public string DeckId { get; set; } = null!;

    [Parameter]
    public CardType? DropDownItemSelected { get; set; }

    [Parameter]
    public EventCallback<CardType?> DropDownItemSelectedChanged { get; set; }

    private BasicNote StartingBasicNote()
    {
        return new()
        {
            DeckId = DeckId
        };
    }

    private async Task SubmitForm(BasicNote newBasicNote)
    {
        ArgumentNullException.ThrowIfNull(newBasicNote.Front);
        ArgumentNullException.ThrowIfNull(newBasicNote.Back);
        ArgumentNullException.ThrowIfNull(newBasicNote.DeckId);

        BasicNote? createdBasicNote = (BasicNote?)await CardService.PostCard(newBasicNote);
        ArgumentNullException.ThrowIfNull(createdBasicNote);

        DropDownItemSelected = null;
        await DropDownItemSelectedChanged.InvokeAsync(DropDownItemSelected);
    }
}