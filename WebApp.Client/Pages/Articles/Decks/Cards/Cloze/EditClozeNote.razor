@using System.ComponentModel.DataAnnotations
@using System.Text.Json

@using AnkiBooks.ApplicationCore.Entities
@using AnkiBooks.ApplicationCore.Interfaces
@using AnkiBooks.ApplicationCore.Services

@inject ILogger<EditClozeNote> Logger
@inject ICardService CardService

<ClozeNoteForm  StartingClozeNote="@StartingClozeNote"
                EditingExisting="true"
                ParentSubmitMethod="@SubmitForm"
                @bind-EditingCard:get="@EditingCard"
                @bind-EditingCard:set="@EditingCardChanged" />

@code {
    [Parameter]
    public ClozeNote? StartingClozeNote { get; set; }

    [Parameter]
    public bool EditingCard { get; set; }

    [Parameter]
    public EventCallback<bool> EditingCardChanged { get; set; }

    private async Task SubmitForm(ClozeNote editClozeNote)
    {
        ArgumentNullException.ThrowIfNull(editClozeNote.Text);
        ArgumentNullException.ThrowIfNull(editClozeNote.DeckId);

        ClozeNote? updatedClozeNote = (ClozeNote?)await CardService.PutCard(editClozeNote);
        ArgumentNullException.ThrowIfNull(updatedClozeNote);

        EditingCard = false;
        await EditingCardChanged.InvokeAsync(EditingCard);
    }
}